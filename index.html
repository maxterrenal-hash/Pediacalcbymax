<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pediatric Calculator</title>
<style>
  :root{--bg:#F5F7FB;--fg:#0F172A;--muted:#475569;--accent:#3B82F6;--line:#E2E8F0;--hdr:#EEF2F7}
  *{box-sizing:border-box}
  body{background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;max-width:1100px;margin:0 auto;padding:20px}
  h1{margin:0 0 12px;font-weight:700}
  details summary{cursor:pointer;font-size:17px;margin:14px 0 6px;font-weight:600;padding:10px 12px;background:#FFF;border:1px solid var(--line);border-radius:12px}

  table{width:100%;border-collapse:separate;border-spacing:0;margin-top:8px;font-size:14px;position:relative;background:#FFF;border:1px solid var(--line);border-radius:14px}
  th{position:sticky;top:0;background:var(--hdr);color:var(--muted);border-bottom:1px solid var(--line);padding:10px 8px;text-align:center;font-weight:600}
  td{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;border-top:1px solid var(--line);padding:10px 8px;text-align:center}
  td.computed,.calc.computed{font-weight:700;font-size:16px}

  /* Compact helpers */
  .quick{margin-top:12px;border-collapse:separate;border-spacing:0;background:#FFF;border:1px solid var(--line);width:100%}
  .first-col th:first-child,.first-col td:first-child{width:220px;max-width:220px;min-width:220px;text-align:left}
  @media (max-width:680px){.first-col th:first-child,.first-col td:first-child{width:180px;max-width:180px;min-width:180px}}

  /* Tooltips */
  .note-tip{cursor:pointer;position:relative;display:inline-block;font-weight:700}
  .note-tip::after{content:attr(data-note);position:absolute;left:50%;top:0;transform:translate(-50%,-110%);background:#FFF;border:1px solid var(--line);padding:6px 10px;border-radius:6px;white-space:normal;display:none;width:260px;z-index:9;box-shadow:0 2px 6px rgba(0,0,0,.15)}
  td:has(.note-tip),th:has(.note-tip){overflow:visible!important}
  .note-tip.touch-active::after{display:block}
  @media(hover:hover){.note-tip:hover::after{display:block}}

  /* Normalize first-column width across groups */
  #resusTable th:first-child,#resusTable td:first-child,#seTable th:first-child,#seTable td:first-child,#seInfusions th:first-child,#seInfusions td:first-child{width:220px;max-width:220px;min-width:220px;text-align:left}
  @media (max-width:680px){#resusTable th:first-child,#resusTable td:first-child,#seTable th:first-child,#seTable td:first-child,#seInfusions th:first-child,#seInfusions td:first-child{width:180px;max-width:180px;min-width:180px}}
  /* Bigger weight input */
  #weightInput{width:260px;max-width:100%;height:44px;font-size:18px;padding:10px 12px;border:1px solid var(--line);border-radius:10px}
  label[for="weightInput"], label{display:inline-flex;align-items:center;gap:10px}
  /* Mobile-friendly layout */
  .weight-bar{position:sticky;top:0;z-index:50;display:flex;gap:12px;align-items:center;background:var(--bg);padding:10px 12px;margin:-10px -12px 8px;border-bottom:1px solid var(--line);backdrop-filter:blur(6px)}
  .weight-bar label{font-weight:600}
  summary{min-height:44px;display:flex;align-items:center}

  @media (max-width: 700px){
    body{padding:14px}
    h1{font-size:20px}
    #weightInput{width:100%;height:48px;font-size:18px}

    /* Turn tables into stacked cards */
    table, thead, tbody, th, td, tr{display:block}
    thead{position:absolute !important;height:1px;width:1px;overflow:hidden;clip:rect(0 0 0 0)}
    tbody tr{background:#FFF;margin:10px 0;border:1px solid var(--line);border-radius:12px;overflow:hidden}
    tbody td{display:flex;justify-content:space-between;gap:12px;align-items:center;padding:12px;border-top:1px solid var(--line)}
    tbody tr td:first-child{border-top:0}
    tbody td::before{content:attr(data-label);font-weight:600;color:var(--muted);text-align:left}

    /* Make big numeric results wrap nicely */
    td, .calc{white-space:normal}

    /* Tooltips fit smaller screens */
    .note-tip::after{width:min(86vw,320px);left:auto;right:0;transform:translate(0,-110%)}
  }
  /* ===== Section Header Colors — Option A: Clinical Calm ===== */
  details summary{border-left-width:6px;transition:background-color .15s ease,border-color .15s ease}
  /* Map by visual order */
  details:nth-of-type(1) { --sec:#0EA5E9; }
details:nth-of-type(1) > summary { --sec:#0EA5E9; }  /* IV Fluids */
  details:nth-of-type(2) { --sec:#6366F1; }
details:nth-of-type(2) > summary { --sec:#6366F1; }  /* Antibiotic Dose Table */
  details:nth-of-type(3) { --sec:#3B82F6; }
details:nth-of-type(3) > summary { --sec:#3B82F6; }  /* Resuscitation */
  details:nth-of-type(4) { --sec:#8B5CF6; }
details:nth-of-type(4) > summary { --sec:#8B5CF6; }  /* Status Epilepticus */
  details:nth-of-type(5) { --sec:#F43F5E; }
details:nth-of-type(5) > summary { --sec:#F43F5E; }  /* Anaphylaxis */
  details:nth-of-type(6) { --sec:#64748B; }
details:nth-of-type(6) > summary { --sec:#64748B; }  /* Diagnostics */

  details > summary{ border-left-color:var(--sec,var(--accent)); }
  details[open] > summary{
    --secShade: color-mix(in srgb, var(--sec,#3B82F6) 12%, #ffffff 88%);
    --secBorder: color-mix(in srgb, var(--sec,#3B82F6) 40%, var(--line) 60%);
    --secText: color-mix(in srgb, var(--sec,#3B82F6) 65%, var(--fg) 35%);
    background: var(--secShade);
    border-color: var(--secBorder);
  }
  @supports not (color-mix(in srgb, #000 10%, #fff)){
    details table thead th{ background: var(--sec, #3B82F6); color:#fff; }
  }
  }

  /* Optional visual bar when open for quick scanning */
  /* Body header rows in tbody (e.g., mini section headers) */
  details table tbody th{
    background: var(--sec, var(--hdr));
    color: #ffffff;
    border-top: 1px solid color-mix(in srgb, var(--sec, #3B82F6) 55%, #000000 45%);
  }
  details > summary{ display:flex; align-items:center; gap:8px; position:relative }
  details[open] > summary::before{
    content:""; position:absolute; left:0; top:0; bottom:0; width:6px; border-radius:12px 0 0 12px; background:var(--sec,var(--accent));
  }
  /* ===== Table header tint to match section color ===== */
  details table thead th{
    background: var(--sec, var(--hdr)); /* exact fill per section */
    color: #ffffff;
    border-bottom-color: color-mix(in srgb, var(--sec, #3B82F6) 55%, #000000 45%);
  }
  @supports not (color-mix(in srgb, #000 10%, #fff)){
    details table thead th{ background: rgba(59,130,246,.08); color: var(--muted); }
  }
  /* Status Epilepticus – add violet bottom border on 2nd & 3rd line header */
  details:nth-of-type(4) #seTable .se-subhdr th{
    border-bottom: 1px solid #8B5CF6 !important; /* violet bottom line */
  }
</style>
</head>
<body>

<h1>Pediatric Calculator</h1>
<div class="weight-bar">
  <label for="weightInput">Weight (kg)</label>
  <input type="number" id="weightInput" min="0" step="0.1" oninput="calculate()">
</div>
<div id="warning" style="color:#ff6b6b;font-weight:700;margin-top:6px"></div>

<details open>
  <summary>IV Fluids</summary>
  <table id="fluidTable">
    <thead>
      <tr><th>Maintenance</th><th>Mild (8h)</th><th>Moderate (6h)</th><th>Severe (6h + 6h)</th><th>Bolus (20 mL/kg)</th></tr>
    </thead>
    <tbody>
      <tr>
        <td id="maintOut"></td><td id="mildOut"></td><td id="modOut"></td><td id="sevOut"></td><td id="bolusOut"></td>
      </tr>
    </tbody>
  </table>

  <table id="fastMedsTable">
    <thead>
      <tr>
        <th>Paracetamol 100mg/mL</th>
        <th>Paracetamol 125mg/5mL</th>
        <th>Paracetamol 250mg/mL</th>
        <th>Ibuprofen 200mg/5mL</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td id="para100"></td>
        <td id="para125"></td>
        <td id="para250"></td>
        <td id="ibu200"></td>
      </tr>
    </tbody>
  </table>
</details>

<details>
  <summary>Antibiotic Dose Table</summary>
  <div id="abx"></div>
</details>

<details>
  <summary>Resuscitation</summary>
  <table id="resusTable">
    <thead><tr><th>Medication / Measure</th><th>Dose / Value</th></tr></thead>
    <tbody>
      <tr><td>ET Tube Size</td><td id="ettSize"></td></tr>
      <tr><td>ET Depth</td><td id="ettDepth"></td></tr>
      <tr><td>Laryngoscope Blade</td><td id="bladeSize"></td></tr>
      <tr><td>Epinephrine (IV/IO) <span class="note-tip" data-note="1:10,000 concentration. 0.01 mg/kg IV/IO q3–5 min. Max single dose 1 mg.">ⓘ</span></td><td id="epiIV"></td></tr>
      <tr><td>Epinephrine (ET) <span class="note-tip" data-note="0.1 mg/kg ET (1:1,000). Use if IV/IO not available.">ⓘ</span></td><td id="epiET"></td></tr>
      <tr><td>Atropine (IV/IO) <span class="note-tip" data-note="0.02 mg/kg IV/IO (min 0.1 mg). Max single dose child 0.5 mg, adolescent 1 mg. May repeat once.">ⓘ</span></td><td id="atroIV"></td></tr>
      <tr><td>Atropine (ET) <span class="note-tip" data-note="0.04–0.06 mg/kg ET.">ⓘ</span></td><td id="atroET"></td></tr>
      <tr><td>Adenosine (1st dose) <span class="note-tip" data-note="0.1 mg/kg rapid IV push (max 6 mg)">ⓘ</span></td><td id="adeno1"></td></tr>
      <tr><td>Adenosine (2nd dose) <span class="note-tip" data-note="0.2 mg/kg rapid IV push (max 12 mg)">ⓘ</span></td><td id="adeno2"></td></tr>
      <tr><td>Amiodarone (SVT/VT) <span class="note-tip" data-note="5 mg/kg IV/IO over 20–60 min. Max single dose 300 mg. Max daily 15 mg/kg.">ⓘ</span></td><td id="amioPulse"></td></tr>
      <tr><td>Amiodarone (Pulseless Arrest) <span class="note-tip" data-note="5 mg/kg IV/IO bolus. May repeat to max daily 15 mg/kg.">ⓘ</span></td><td id="amioArrest"></td></tr>
      <tr><td>Cardioversion (1st Shock) <span class="note-tip" data-note="Synchronized cardioversion: 0.5–1 J/kg initial">ⓘ</span></td><td id="cv1"></td></tr>
      <tr><td>Cardioversion (2nd Shock) <span class="note-tip" data-note="If ineffective, increase to 2 J/kg">ⓘ</span></td><td id="cv2"></td></tr>
      <tr><td>Defibrillation (2 J/kg) <span class="note-tip" data-note="Initial unsynchronized shock: 2 J/kg">ⓘ</span></td><td id="defib1"></td></tr>
      <tr><td>Defibrillation (4 J/kg) <span class="note-tip" data-note="Second shock: 4 J/kg; may increase up to 10 J/kg">ⓘ</span></td><td id="defib2"></td></tr>
    </tbody>
  </table>
</details>

<details>
  <summary>Status Epilepticus</summary>
  <table id="seInitialTop" class="quick first-col">
    <thead>
      <tr>
        <th>Initial Treatment</th>
        <th>IV</th>
        <th>IN/IM/PR</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Midazolam</td>
        <td><span id="midIV_top" class="calc"></span> <span class="note-tip" data-note="0.1–0.2 mg/kg IV">ⓘ</span></td>
        <td><span id="midINIM_top" class="calc"></span> <span class="note-tip" data-note="0.2 mg/kg IN/IM">ⓘ</span></td>
      </tr>
      <tr>
        <td>Diazepam</td>
        <td><span id="diazIV_top" class="calc"></span> <span class="note-tip" data-note="0.1–0.3 mg/kg IV">ⓘ</span></td>
        <td><span id="diazPR_top" class="calc"></span> <span class="note-tip" data-note="0.5 mg/kg PR">ⓘ</span></td>
      </tr>
    </tbody>
  </table>

  <table id="seTable" class="quick first-col">
    <tbody>
      <tr class="se-subhdr se-g1b">
        <th>2nd and 3rd Line</th>
        <th>IV</th>
      </tr>
      <tr class="row-pheno2">
        <td>Phenobarbital</td>
        <td><span id="phenoIV2" class="calc"></span> <span class="note-tip" data-note="20 mg/kg (max 800 mg)">ⓘ</span></td>
      </tr>
      <tr class="row-pheny">
        <td>Phenytoin</td>
        <td><span id="phenyIV" class="calc"></span> <span class="note-tip" data-note="20 mg/kg (max 1000 mg)">ⓘ</span></td>
      </tr>
      <tr class="row-valp2">
        <td>Sodium Valproate</td>
        <td><span id="valpIV2" class="calc"></span> <span class="note-tip" data-note="40–60 mg/kg">ⓘ</span></td>
      </tr>
      <tr class="row-lev2">
        <td>Levetiracetam</td>
        <td><span id="levIV2" class="calc"></span> <span class="note-tip" data-note="60 mg/kg">ⓘ</span></td>
      </tr>
    </tbody>
  </table>

  <table id="seInfusions" class="quick">
    <thead>
      <tr>
        <th>4th Line</th>
        <th>IV Loading (mg/kg)</th>
        <th>Maintenance (mg/kg/hr)</th>
        <th>Max Dose</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Propofol</td>
        <td><span id="propLoad" class="calc"></span> <span class="note-tip" data-note="0.5–2 mg/kg">ⓘ</span></td>
        <td><span id="propMaint" class="calc"></span> <span class="note-tip" data-note="1.5–4 mg/kg/hr">ⓘ</span></td>
        <td><span id="propMax" class="calc"></span> <span class="note-tip" data-note="5 mg/kg">ⓘ</span></td>
      </tr>
      <tr>
        <td>Midazolam Drip</td>
        <td><span id="midDripLoad" class="calc"></span> <span class="note-tip" data-note="0.1–0.2 mg/kg">ⓘ</span></td>
        <td><span id="midDripMaint" class="calc"></span> <span class="note-tip" data-note="0.05–0.4 mg/kg/hr">ⓘ</span></td>
        <td><span id="midDripMax" class="calc"></span> <span class="note-tip" data-note="10 mg">ⓘ</span></td>
      </tr>
      <tr class="row-ketamine">
        <td>Ketamine</td>
        <td><span id="ketaLoad" class="calc"></span> <span class="note-tip" data-note="2–3 mg/kg">ⓘ</span></td>
        <td><span id="ketaMaint" class="calc"></span> <span class="note-tip" data-note="0.01–0.06 mg/kg/hr">ⓘ</span></td>
        <td><span id="ketaMax" class="calc"></span></td>
      </tr>
    </tbody>
  </table>
</details>

<details>
  <summary>Anaphylaxis</summary>
  <table id="anaEpiTable" class="quick first-col">
    <thead>
      <tr>
        <th>Medication</th>
        <th>IM</th>
        <th>IV Infusion</th>
        <th>IV Fluids</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Epinephrine</td>
        <td id="anaEpiIM"><span class="calc"></span> <span class="note-tip" data-note="0.01 mg/kg (1 mg/mL)">ⓘ</span></td>
        <td id="anaEpiInf"><span class="calc"></span> <span class="note-tip" data-note="0.1–0.3 µg/kg/min; max 1.5 µg/kg/min">ⓘ</span></td>
        <td id="anaEpiFluids"><span class="calc"></span></td>
      </tr>
    </tbody>
  </table>

  <table id="anaAdjTable" class="quick">
    <thead>
      <tr>
        <th>Diphenhydramine</th>
        <th>Ranitidine</th>
        <th>Hydrocortisone</th>
        <th>Methylprednisolone</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td id="anaDip"><span class="calc"></span> <span class="note-tip" data-note="1 mg/kg q6h">ⓘ</span></td>
        <td id="anaRani"><span class="calc"></span> <span class="note-tip" data-note="0.5 mg/kg over 5 minutes">ⓘ</span></td>
        <td id="anaHydro"><span class="calc"></span> <span class="note-tip" data-note="5–10 mg/kg IV (max 500 mg)">ⓘ</span></td>
        <td id="anaMethyl"><span class="calc"></span> <span class="note-tip" data-note="1–2 mg/kg IV (max 125 mg)">ⓘ</span></td>
      </tr>
    </tbody>
  </table>
</details>

<details>
  <summary>Diagnostics / Self‑tests</summary>
  <button id="runTests" type="button">Run tests</button>
  <pre id="testOut"></pre>
</details>

<script>
// ===== Utilities =====
function setSectionsOpen(open){document.querySelectorAll('details').forEach(d=>{if(open){d.setAttribute('open','');}else{d.removeAttribute('open');}});}
function mark(el, txt){if(!el) return; el.textContent=txt; el.classList.add('computed');}
function fillIf(id, txt){const el=document.getElementById(id); if(el){mark(el, txt);} }
function setDataLabelsFromThead(table){ if(!table) return; const thead=table.querySelector('thead'); const labels=[...(thead?thead.querySelectorAll('th'):[])].map(th=>th.textContent.trim()); table.querySelectorAll('tbody tr').forEach(tr=>{[...tr.cells].forEach((td,i)=>{ if(labels[i]) td.setAttribute('data-label', labels[i]);});}); }
function setAllDataLabels(){ document.querySelectorAll('table').forEach(t=>setDataLabelsFromThead(t)); }

// ===== Core compute =====
function calculate(){
  const raw=document.getElementById('weightInput').value; const w=parseFloat(String(raw).replace(',','.'));
  const warn=document.getElementById('warning');
  if(!Number.isFinite(w) || w<=0){ warn.textContent=''; document.querySelectorAll('.computed').forEach(x=>x.textContent=''); setSectionsOpen(false); return; }
  warn.textContent=(w<5||w>120)?'⚠ Check dosing range':''; setSectionsOpen(true);

  // IV Fluids
  let t = w<=10?100*w : w<=20?1000+50*(w-10) : 1500+20*(w-20);
  fillIf('maintOut', `${t.toFixed(0)} mL/24h (${(t/24).toFixed(1)} mL/hr)`);
  fillIf('mildOut', `${((w*50)/8).toFixed(1)} mL/hr × 8h`);
  fillIf('modOut', `${((w*100)/6).toFixed(1)} mL/hr × 6h`);
  fillIf('sevOut', `${((w*100)/6).toFixed(1)} mL/hr × 6h then ${((w*50)/6).toFixed(1)} mL/hr × 6h`);
  fillIf('bolusOut', `${(w*20).toFixed(0)} mL`);

  // Antipyretics
  const pLo=10*w, pHi=20*w; fillIf('para100',(pLo/100).toFixed(2)+'–'+(pHi/100).toFixed(2)+' mL'); fillIf('para125',(pLo/25).toFixed(2)+'–'+(pHi/25).toFixed(2)+' mL'); fillIf('para250',(pLo/250).toFixed(2)+'–'+(pHi/250).toFixed(2)+' mL'); fillIf('ibu200',((10*w)/40).toFixed(2)+' mL');

  // Antibiotics quick tables
  (function(){
    const wv=w; const f=(id,val)=>{const el=document.getElementById(id); if(el){el.textContent=val; el.classList.add('computed');}};
    // Amoxicillin (mL)
    const c100=100, c125=125/5, c250=250/5;
    f('amox100q8', (((25*wv)/3)/c100).toFixed(2)+'–'+(((50*wv)/3)/c100).toFixed(2)+' mL');
    f('amox100q12',(((25*wv)/2)/c100).toFixed(2)+'–'+(((50*wv)/2)/c100).toFixed(2)+' mL');
    f('amox125q8', (((25*wv)/3)/c125).toFixed(2)+'–'+(((50*wv)/3)/c125).toFixed(2)+' mL');
    f('amox125q12',(((25*wv)/2)/c125).toFixed(2)+'–'+(((50*wv)/2)/c125).toFixed(2)+' mL');
    f('amox250q8', (((25*wv)/3)/c250).toFixed(2)+'–'+(((50*wv)/3)/c250).toFixed(2)+' mL');
    f('amox250q12',(((25*wv)/2)/c250).toFixed(2)+'–'+(((50*wv)/2)/c250).toFixed(2)+' mL');
    // AmpSulb (mg)
    f('ampSulbIVq6', ((200*wv)/4).toFixed(0)+' mg');
    // Azithro (mL) 200/5
    f('azith200q24', ((10*wv)/(200/5)).toFixed(2)+' mL');
    // Cefixime (mL)
    f('cefix100q12', ( (8*wv)/(100/5) ).toFixed(2)+' mL');
    f('cefix100q24', ( (8*wv)/(100/5) ).toFixed(2)+' mL');
    f('cefix20_5q12', ( (8*wv)/(20/5) ).toFixed(2)+' mL');
    f('cefix20_5q24', ( (8*wv)/(20/5) ).toFixed(2)+' mL');
    // Ceftriaxone (mg)
    const mgMin=75*wv, mgMax=100*wv; f('ceftriaIVq12',(mgMin/2).toFixed(0)+'–'+(mgMax/2).toFixed(0)+' mg'); f('ceftriaIVq24',mgMin.toFixed(0)+'–'+mgMax.toFixed(0)+' mg');
    // Cefuroxime (PO mL q12, IV mg q8)
    f('cefur125q12', (((20*wv)/2)/(125/5)).toFixed(2)+'–'+(((30*wv)/2)/(125/5)).toFixed(2)+' mL');
    f('cefur250q12', (((20*wv)/2)/(250/5)).toFixed(2)+'–'+(((30*wv)/2)/(250/5)).toFixed(2)+' mL');
    f('cefurIVq8', ((100*wv)/3).toFixed(0)+'–'+((150*wv)/3).toFixed(0)+' mg');
    // Cephalexin (mL q12)
    f('cephal100q12',(((25*wv)/2)/100).toFixed(2)+'–'+(((50*wv)/2)/100).toFixed(2)+' mL');
    f('cephal125q12',(((25*wv)/2)/(125/5)).toFixed(2)+'–'+(((50*wv)/2)/(125/5)).toFixed(2)+' mL');
    f('cephal250q12',(((25*wv)/2)/(250/5)).toFixed(2)+'–'+(((50*wv)/2)/(250/5)).toFixed(2)+' mL');
    // Clarithro (mL q12)
    f('clarith125q12',(((15*wv)/2)/(125/5)).toFixed(2)+' mL');
    // Clinda (mL q8)
    f('clinda75q8',(((20*wv)/3)/(75/5)).toFixed(2)+'–'+(((30*wv)/3)/(75/5)).toFixed(2)+' mL');
    // Co-amoxiclav (mL)
    function co(prefix,conc){ f(prefix+'q8', (((25*wv)/3)/conc).toFixed(2)+'–'+(((45*wv)/3)/conc).toFixed(2)+' mL'); f(prefix+'q12',(((25*wv)/2)/conc).toFixed(2)+'–'+(((45*wv)/2)/conc).toFixed(2)+' mL'); }
    co('coamox156',156.25/5); co('coamox228',228.5/5); co('coamox312',312.5/5); co('coamox457',457/5);
    // Metronidazole (mL q6)
    f('metro125q6',(((15*wv)/4)/(125/5)).toFixed(2)+'–'+(((30*wv)/4)/(125/5)).toFixed(2)+' mL');
  })();

  // Resuscitation
  let ett=w<3?3:w<=5?3.5:w<=10?4:w<=15?4.5:w<=20?5:(w/10+3.5); ett=Math.round(ett*2)/2;
  fillIf('ettSize', ett.toFixed(1)+' mm'); fillIf('ettDepth',(ett*3).toFixed(1)+' cm');
  fillIf('bladeSize', w<3?'Miller 0': w<5?'Miller 1': w<10?'Miller 1/Mac2': w<20?'Mac2':'Mac3');
  fillIf('epiIV', (0.01*w).toFixed(3)+' mg = '+(0.01*w*10).toFixed(2)+' mL (1:10,000)');
  fillIf('epiET', (0.1*w).toFixed(2)+' mg = '+(0.1*w).toFixed(2)+' mL (1:1,000)');
  fillIf('atroIV', Math.max(0.1,0.02*w).toFixed(2)+' mg');
  fillIf('atroET', (0.04*w).toFixed(2)+'–'+(0.06*w).toFixed(2)+' mg');
  fillIf('adeno1', Math.min(0.1*w,6).toFixed(2)+' mg'); fillIf('adeno2', Math.min(0.2*w,12).toFixed(2)+' mg');
  let amPulse=5*w, amPulseVol=amPulse/50; fillIf('amioPulse', amPulse.toFixed(1)+' mg = '+amPulseVol.toFixed(2)+' mL (150 mg/3 mL)');
  let amArrest=5*w, amArrestVol=amArrest/50; fillIf('amioArrest', amArrest.toFixed(1)+' mg = '+amArrestVol.toFixed(2)+' mL (150 mg/3 mL)');
  fillIf('cv1',(w*1).toFixed(0)+' J'); fillIf('cv2',(w*2).toFixed(0)+' J'); fillIf('defib1',(w*2).toFixed(0)+' J'); fillIf('defib2',(w*4).toFixed(0)+' J');

  // Status Epilepticus
  fillIf('midIV_top',(0.10*w).toFixed(2)+'–'+(0.20*w).toFixed(2)+' mg'); fillIf('midINIM_top',(0.20*w).toFixed(2)+' mg');
  fillIf('diazIV_top',(0.10*w).toFixed(2)+'–'+(0.30*w).toFixed(2)+' mg'); fillIf('diazPR_top',(0.50*w).toFixed(2)+' mg');
  // 2nd/3rd line
  fillIf('phenoIV2',(20*w).toFixed(1)+' mg'); fillIf('phenyIV',(20*w).toFixed(1)+' mg'); fillIf('valpIV2',(40*w).toFixed(1)+'–'+(60*w).toFixed(1)+' mg'); fillIf('levIV2',(60*w).toFixed(1)+' mg');
  // Infusions
  fillIf('propLoad',(0.5*w).toFixed(2)+'–'+(2.0*w).toFixed(2)+' mg'); fillIf('propMaint',(1.5*w).toFixed(2)+'–'+(4.0*w).toFixed(2)+' mg/hr'); fillIf('propMax',(5*w).toFixed(2)+' mg');
  fillIf('midDripLoad',(0.10*w).toFixed(2)+'–'+(0.20*w).toFixed(2)+' mg'); fillIf('midDripMaint',(0.05*w).toFixed(2)+'–'+(0.40*w).toFixed(2)+' mg/hr'); fillIf('midDripMax','10 mg');
  fillIf('ketaLoad',(2.0*w).toFixed(2)+'–'+(3.0*w).toFixed(2)+' mg'); fillIf('ketaMaint',(0.01*w).toFixed(3)+'–'+(0.06*w).toFixed(3)+' mg/hr'); fillIf('ketaMax','—');

  // Anaphylaxis
  const epiIMmg=(0.01*w), epiIMmL=epiIMmg; fillIf('anaEpiIM', epiIMmg.toFixed(3)+' mg = '+epiIMmL.toFixed(3)+' mL (1:1,000)');
  const epiInfMin=(0.1*w), epiInfMax=(0.3*w), epiInfCeil=(1.5*w); fillIf('anaEpiInf', epiInfMin.toFixed(2)+'–'+epiInfMax.toFixed(2)+' µg/min (max '+epiInfCeil.toFixed(1)+' µg/min)');
  fillIf('anaEpiFluids', (10*w).toFixed(0)+'–'+(20*w).toFixed(0)+' mL');
  fillIf('anaDip', (1*w).toFixed(1)+' mg');
  const hydLo=Math.min(500,5*w), hydHi=Math.min(500,10*w); fillIf('anaHydro', hydLo.toFixed(0)+'–'+hydHi.toFixed(0)+' mg');
  const metLo=Math.min(125,1*w), metHi=Math.min(125,2*w); fillIf('anaMethyl', metLo.toFixed(0)+'–'+metHi.toFixed(0)+' mg');
  fillIf('anaRani', (0.5*w).toFixed(1)+' mg');
}
window.calculate = calculate; // ensure global for inline handler

// ===== Render antibiotic tables from config (DOM slimming) =====
(function renderAbx(){
  const ABX=[
    {id:'amoxQuick', t:'Amoxicillin', note:'q8h/q12h 25–50 mg/kg', cols:['q8h','q12h'], rows:[['100mg/mL','amox100q8','amox100q12'],['125mg/5mL','amox125q8','amox125q12'],['250mg/5mL','amox250q8','amox250q12']]},
    {id:'ampSulbQuick', t:'Ampicillin–Sulbactam', note:'200 mg/kg/day IV q6h', cols:['q6h'], rows:[['IV','ampSulbIVq6']]},
    {id:'azithQuick', t:'Azithromycin', note:'10 mg/kg q24h', cols:['q24h'], rows:[['200mg/5mL','azith200q24']]},
    {id:'cefixQuick', t:'Cefixime', note:'8 mg/kg q12h or q24h', cols:['q12h','q24h'], rows:[['100mg/5mL','cefix100q12','cefix100q24'],['20mg/5mL','cefix20_5q12','cefix20_5q24']]},
    {id:'ceftriaQuick', t:'Ceftriaxone', note:'75–100 mg/kg IV q12h or q24h', cols:['q12h','q24h'], rows:[['IV','ceftriaIVq12','ceftriaIVq24']]},
    {id:'cefurQuick', t:'Cefuroxime', note:'PO 20–30 mg/kg q12h; IV 100–150 mg/kg/day q8h', cols:['q8h','q12h'], rows:[['125mg/5mL','-','cefur125q12'],['250mg/5mL','-','cefur250q12'],['IV','cefurIVq8','-']]},
    {id:'cephalQuick', t:'Cephalexin', note:'25–50 mg/kg q12h', cols:['q12h'], rows:[['100mg/mL','cephal100q12'],['125mg/5mL','cephal125q12'],['250mg/5mL','cephal250q12']]},
    {id:'clarithQuick', t:'Clarithromycin', note:'15 mg/kg q12h', cols:['q12h'], rows:[['125mg/5mL','clarith125q12']]},
    {id:'clindaQuick', t:'Clindamycin', note:'20–30 mg/kg q8h', cols:['q8h'], rows:[['75mg/5mL','clinda75q8']]},
    {id:'coamoxQuick', t:'Co‑amoxiclav', note:'25–45 mg/kg q8h or q12h', cols:['q8h','q12h'], rows:[['156.25mg/5mL','coamox156q8','coamox156q12'],['228.5mg/5mL','coamox228q8','coamox228q12'],['312.5mg/5mL','coamox312q8','coamox312q12'],['457mg/5mL','coamox457q8','coamox457q12']]},
    {id:'metroQuick', t:'Metronidazole', note:'15–30 mg/kg/day q6h', cols:['q6h'], rows:[['125mg/5mL','metro125q6']]}
  ];
  const html=ABX.map(x=>`<table class="quick first-col" id="${x.id}"><thead><tr><th>${x.t}${x.note?` <span class=\"note-tip\" data-note=\"${x.note}\">ⓘ</span>`:""}</th>${x.cols.map(c=>`<th>${c}</th>`).join('')}</tr></thead><tbody>${x.rows.map(r=>`<tr><td>${r[0]}</td>${x.cols.map((_,i)=>`<td id=\"${r[i+1]}\"></td>`).join('')}</tr>`).join('')}</tbody></table>`).join('');
  const mount=document.getElementById('abx'); if(mount) mount.innerHTML=html;
})();

// ===== Tooltip toggle (mobile-friendly) =====
(function(){
  document.addEventListener('click',(e)=>{
    const open=document.querySelector('.note-tip.touch-active');
    if(open && !open.contains(e.target)) open.classList.remove('touch-active');
    const tip=e.target.closest('.note-tip'); if(tip){ tip.classList.toggle('touch-active'); }
  });
})();

// ===== Self-tests =====
(function(){
  const btn=document.getElementById('runTests'); const out=document.getElementById('testOut'); if(!btn||!out) return;
  function assertEq(name, got, exp){ return (got===exp)?`✅ ${name}`:`❌ ${name}\n   got: ${got}\n   exp: ${exp}`; }
  btn.addEventListener('click',()=>{
    document.getElementById('weightInput').value='20'; calculate();
    const lines=[];
    lines.push(assertEq('Bolus 20kg',''+document.getElementById('bolusOut').textContent,'400 mL'));
    lines.push(assertEq('PCM 100mg/mL',''+document.getElementById('para100').textContent,'2.00–4.00 mL'));
    lines.push(assertEq('Midazolam IV top',''+document.getElementById('midIV_top').textContent,'2.00–4.00 mg'));
    lines.push(assertEq('Diazepam PR top',''+document.getElementById('diazPR_top').textContent,'10.00 mg'));
    lines.push(assertEq('Ceftriaxone q24',''+document.getElementById('ceftriaIVq24').textContent,'1500–2000 mg'));
    out.textContent=lines.join('\n');
  });
})();

// ===== Init =====
window.addEventListener('DOMContentLoaded',()=>{
  setAllDataLabels();
  const w=document.getElementById('weightInput');
  if(!w || !w.value){
    setSectionsOpen(false);
    return;
  }
  const start=parseFloat(String(w.value).replace(',','.'));
  if(!Number.isFinite(start) || start<=0){
    setSectionsOpen(false);
    return;
  }
  calculate();
});
</script>
</body>
</html>
